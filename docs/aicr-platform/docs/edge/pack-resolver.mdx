---
title: "Pack Resolver"
description: "How AICR deterministically resolves active pack capabilities for each tenant."
---

# Pack Resolver

The pack resolver determines exactly which capabilities are active for a tenant at any moment. Its core guarantee: **same inputs → same outputs**.

## Resolution Algorithm

Given a tenant's configuration, the resolver produces a deterministic capability set:

```
Inputs:
  - tenantId
  - tenant.tier
  - tenant.enabledPacks (list of pack IDs + versions)
  - feature flags for this tenant

Process:
  1. Start with platform core (always active)
  2. Add tier-default packs for tenant.tier
  3. Resolve dependency graph (topological sort)
  4. Apply tenant.enabledPacks overrides
  5. Apply feature flag overrides
  6. Validate no conflicts in resolved set

Output:
  - ResolvedCapabilities { packId → version, surface → component, agent → prompt }
```

## Dependency Resolution

The resolver handles transitive dependencies automatically:

```
tenant enables: approval-workflows@1.2.0
  → requires: identity-management@>=2.0.0
    → requires: core@>=1.0.0 (always active)
  → requires: notification-engine@>=1.0.0

Resolved: core@1.5.0, identity-management@2.1.0,
          notification-engine@1.3.0, approval-workflows@1.2.0
```

If a dependency conflict is detected, the resolver throws before activation and the TenantAgent creates a remediation work item.

## Caching

Resolution results are cached per tenant with a 5-minute TTL. Cache is invalidated immediately when:
- A pack is enabled/disabled for the tenant
- A feature flag changes
- A new pack version is promoted

## Version Pinning

Tenants can pin to a specific pack version to prevent automatic upgrades:

```bash
pnpm packs:pin --tenant <tenantId> --pack approval-workflows --version 1.1.0
```

Pinned tenants receive security notices but don't auto-upgrade until the pin is removed.

## Rollback

If a pack version causes issues, rollback is immediate:

```bash
pnpm packs:rollback --tenant <tenantId> --pack approval-workflows
# Reverts to the previously active version
```

The previous version is already cached on the tenant's resolver, so rollback takes effect within the next cache refresh cycle (< 5 minutes).
